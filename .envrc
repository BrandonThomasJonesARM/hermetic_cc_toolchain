export PATH="$(git rev-parse --show-toplevel)/bin:$PATH"

[[ -x bin/bazel ]] && exit

case $(uname -m) in
    x86_64)
        goarch=amd64;;
    aarch64)
        goarch=arm64;;
    *)
        >&2 echo "unsupported architecture $(uname -m)"
        exit 1;;
esac

bzl="bazelisk-$(uname | tr A-Z a-z)-${goarch}"

rm -f "bin/$bzl"
wget --no-verbose "https://github.com/bazelbuild/bazelisk/releases/download/v1.10.1/$bzl" \
    -O "bin/$bzl"

sha256sum -c --ignore-missing <<-EOF
e485bbf84532d02a60b0eb23c702610b5408df3a199087a4f2b5e0995bbf2d5a  bin/bazelisk-darwin-amd64
c22d48601466d9d3b043ccd74051f2f4230f9b9f4509f097017c97303aa88d13  bin/bazelisk-darwin-arm64
4cb534c52cdd47a6223d4596d530e7c9c785438ab3b0a49ff347e991c210b2cd  bin/bazelisk-linux-amd64
c1de6860dd4f8d5e2ec270097bd46d6a211b971a0b8b38559784bd051ea950a1  bin/bazelisk-linux-arm64
EOF

chmod a+x "bin/$bzl"
mv "bin/$bzl" bin/bazel
